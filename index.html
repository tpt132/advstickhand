<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Blue Puck Tracker</title>
<style>
  video, canvas {
    position: absolute;
    top: 0; left: 0;
    width: 640px; height: 480px;
  }
  canvas {
    pointer-events: none;
  }
</style>
</head>
<body>
<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

canvas.width = 640;
canvas.height = 480;

navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
  video.srcObject = stream;
});

function hexToRgb(hex) {
  const bigint = parseInt(hex.slice(1), 16);
  return {
    r: (bigint >> 16) & 255,
    g: (bigint >> 8) & 255,
    b: bigint & 255
  };
}

// Target blue colors from your hex codes:
const blueColors = [
  hexToRgb('#19224f'),
  hexToRgb('#0a2e6c')
];

// Simple helper to check if a pixel is "close" to one of target blues
function isBluePixel(r, g, b) {
  // Euclidean distance in RGB space to each blue, threshold tuned manually
  const threshold = 60;
  for (const c of blueColors) {
    const dist = Math.sqrt(
      (r - c.r)**2 + (g - c.g)**2 + (b - c.b)**2
    );
    if (dist < threshold) return true;
  }
  return false;
}

function trackBluePuck() {
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
  const frame = ctx.getImageData(0, 0, canvas.width, canvas.height);
  const data = frame.data;

  let count = 0;
  let sumX = 0;
  let sumY = 0;

  for (let i = 0; i < data.length; i += 4) {
    const r = data[i];
    const g = data[i + 1];
    const b = data[i + 2];

    if (isBluePixel(r, g, b)) {
      const pixelIndex = i / 4;
      const x = pixelIndex % canvas.width;
      const y = Math.floor(pixelIndex / canvas.width);
      sumX += x;
      sumY += y;
      count++;
    }
  }

  if (count > 100) { // Minimum pixels to count as detected
    const avgX = sumX / count;
    const avgY = sumY / count;

    // Draw a circle on the detected puck position
    ctx.beginPath();
    ctx.arc(avgX, avgY, 15, 0, 2 * Math.PI);
    ctx.lineWidth = 4;
    ctx.strokeStyle = 'red';
    ctx.stroke();

    // Optional: log puck position
    console.log(`Puck detected at: (${Math.round(avgX)}, ${Math.round(avgY)})`);
  }

  requestAnimationFrame(trackBluePuck);
}

video.addEventListener('playing', () => {
  trackBluePuck();
});
</script>
</body>
</html>
